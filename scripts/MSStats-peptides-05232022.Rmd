---
title: "peptide-comparison"
output: html_document
---
May 23, 2022

Script to use MSStats to look at peptides from 2015 Oyster DIA proteomics. Compare peptide abundance between recently-settled oyster larvae held at 23C vs 29C. 

Script roughly follows:
Yaamini's MSStats script: https://github.com/RobertsLab/project-oyster-oa/blob/master/analyses/DNR_Skyline_20170524/2017-06-22-MSstats/2017-06-22-MSstats.R

MSstats manual (starting p44):http://msstats.org/wp-content/uploads/2017/01/MSstats_v3.7.3_manual.pdf
```{r}
sessionInfo()
```

```{r}
#if (!require("BiocManager", quietly = TRUE))
    install.packages("BiocManager")

#BiocManager::install("MSstats")
```

```{r}
#install.packages("dplyr")
```

```{r}
library(MSstats)
library(dplyr)
```


## Import Data

read in .csv of PeakAreas from 01-MSstats-Cgseed-DIA.R. In excel, I copy and pasted the peptide sequences into the ProteinName column. 
```{r}
PeakAreas <- read.csv("../data/20220611-PeakAreas.csv")
head(PeakAreas)
```

PeakAreas has 188508 obs and 15 variables



## Process Data
Add fraction column and have all cells listed as "1" from this google forum post: https://groups.google.com/forum/#!searchin/msstats/fractionations%7Csort:date/msstats/dVh6IEE0xTE/jiokWrNSCgAJ
```{r}
PeakAreas$Fraction <- "1"
PeakAreas
```

dataProcess function
```{r}
QuantData <- dataProcess(PeakAreas, normalization='equalizeMedians',
                         summaryMethod="TMP",
                         censoredInt="0",
                         MBimpute=TRUE,
                         maxQuantileforCensored=0.999)
```

```{r}
head(QuantData$ProcessedData)
```
## Create dataprocess plots

```{r}
#dataProcessPlots(data = QuantData, type = "ProfilePlot", width=5, height=5, address = "../analyses/")
```

Note: 20220614 --> manually moved the profile plots to analyses/MS_stats/peptides 

```{r}
#dataProcessPlots(data = QuantData, type = "QCPlot", width=5, height=5, address = "../analyses/MS_stats/peptides")
```

```{r}
#dataProcessPlots(data = QuantData, type="Conditionplot", width=5, height=5, address = "../analyses/MS_stats/peptides/peptides")
```

## Create comparison plots

### Create contrast matrix
```{r}
levels(QuantData$ProteinLevelData$GROUP) #Levels: "23C" and "29C"
comparison <- matrix(c(-1, 1), nrow = 1)
row.names(comparison) <- "23C-29C"
groups = levels(QuantData$ProteinLevelData$GROUP)
colnames(comparison) <- groups[order(as.numeric(groups))]
print(comparison)
```
Use this to get help creating contrast matrix in above code chunk:
```{r}
?groupComparison
```


```{r}
#### GROUP COMPARISON
testResultOneComparison <- groupComparison(contrast.matrix = comparison, data = QuantData) 
testResultOneComparison$ComparisonResult #View results
proteinComparisonResults <- testResultOneComparison$ComparisonResult #Save as new dataframe
write.csv(proteinComparisonResults, "analyses/20220617-2015Cgseed-peptidecomp.csv", col.names = c("Peptide", "Label", "log2FC", "SE", "Tvalue", "DF", "pvalue"), row.names = F) #write out comparison
```

