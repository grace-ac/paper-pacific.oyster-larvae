---
title: "peptide-comparison"
output: html_document
---
May 23, 2022

Script to use MSStats to look at peptides from 2015 Oyster DIA proteomics. Compare peptide abundance between recently-settled oyster larvae held at 23C vs 29C. 

Script roughly follows:
Yaamini's MSStats script: https://github.com/RobertsLab/project-oyster-oa/blob/master/analyses/DNR_Skyline_20170524/2017-06-22-MSstats/2017-06-22-MSstats.R

MSstats manual (starting p44):http://msstats.org/wp-content/uploads/2017/01/MSstats_v3.7.3_manual.pdf
```{r}
sessionInfo()
```

```{r}
library(MSstats)
library(dplyr)
```


## Import Data

read in .csv of PeakAreas from 01-MSstats-Cgseed-DIA.R. In excel, I copy and pasted the peptide sequences into the ProteinName column. 
```{r}
PeakAreas <- read.csv("../data/20220611-PeakAreas.csv")
head(PeakAreas)
```

PeakAreas has 188508 obs and 15 variables



## Process Data
Add fraction column and have all cells listed as "1" from this google forum post: https://groups.google.com/forum/#!searchin/msstats/fractionations%7Csort:date/msstats/dVh6IEE0xTE/jiokWrNSCgAJ
```{r}
PeakAreas$Fraction <- "1"
PeakAreas
```

dataProcess function
```{r}
QuantData <- dataProcess(PeakAreas, normalization='equalizeMedians',
                         summaryMethod="TMP",
                         censoredInt="0",
                         MBimpute=TRUE,
                         maxQuantileforCensored=0.999)
```
Error in dataProcess(PeakAreas, normalization = "equalizeMedians", summaryMethod = "TMP", : Please remove duplicate rows in the list above.

https://skyline.ms/announcements/home/support/thread.view?rowId=27558 
the following columns need to uniquely identify each row:
ProteinName, PeptideModifiedSequence, PrecursorCharge, FragmentIon, ProductCharge, IsotopeLabelType, FileName

Remove any duplicate rows:
```{r}
library(dplyr)
mydata <- PeakAreas

# Remove duplicate rows of the dataframe
mydata %>%
  distinct(ProteinName, PeptideSequence, PrecursorCharge, FragmentIon, ProductCharge, IsotopeLabelType, Run, .keep_all = TRUE)
```
There aren't any duplicate rows... 


The rows are all unique. The file names are unique, and there are 2 bioreplicates... so I'm not sure how to fix this. 

Just playing around... I'll remove all rows associated with biorep 2. 
```{r}
mydata <- filter(PeakAreas, BioReplicate == 1)
head(mydata)
```

Retry dataProcess with mydata (346726 obs, 16 columns)
```{r}
QuantData <- dataProcess(mydata, normalization='equalizeMedians',
                         summaryMethod="TMP",
                         censoredInt="0",
                         MBimpute=TRUE,
                         maxQuantileforCensored=0.999)
```

Even with removing bioreplicate rows... still says that there are duplicate rows. I wonder if it's because the first two columns are the same?? 

