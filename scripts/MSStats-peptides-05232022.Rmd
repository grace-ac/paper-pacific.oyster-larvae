---
title: "peptide-comparison"
output: html_document
---

Script to use MSStats to look at peptides from 2015 Oyster DIA proteomics. Compare peptide abundance between recently-settled oyster larvae held at 23C vs 29C. 

Script roughly follows:
Yaamini's MSStats script: https://github.com/RobertsLab/project-oyster-oa/blob/master/analyses/DNR_Skyline_20170524/2017-06-22-MSstats/2017-06-22-MSstats.R

MSstats manual (starting p44):http://msstats.org/wp-content/uploads/2017/01/MSstats_v3.7.3_manual.pdf
```{r}
sessionInfo()
```

```{r}
#library(MSstats)
library(dplyr)
```


## Import Data

read in .csv (locally. zip is in github)
```{r}
rawPeakAreas <- read.csv("../data/20190403-MSstats-report_peptides.csv")
head(rawPeakAreas)
```

rename columns 
(Note: this file was made roughly in excel by pasting the Petide.Sequence into the Protein.Name column)
```{r}
names(rawPeakAreas) <- c("ProteinName", "PeptideSequence", "PeptideModifiedSequence", "PrecursorCharge", "PrecursorMz", "FragmentIon", "ProductCharge", "ProductMz", "IsotopeLabelType", "Condition", "BioReplicate", "FileName", "Area", "StandardType", "Truncated", "DetectionQValue")

head(rawPeakAreas)
```

convert raw Skyline output to MSstats format     
rawPeakAreas has 719904 obs and 16 variables
```{r}
PeakAreas <- SkylinetoMSstatsFormat(rawPeakAreas)
head(PeakAreas)
```
PeakAreas has 693452 obs and 15 variables

Note:
** Peptides, that are used in more than one proteins, are removed.
NAs introduced by coercionNAs introduced by coercion** Intensities with great than 0.01 in DetectionQValue are replaced with zero.
** 14 features have all NAs or zero intensity values and are removed.
** 6198 features have 1 or 2 intensities across runs and are removed.

## Process Data

```{r}
QuantData <- dataProcess(PeakAreas, normalization='equalizeMedians',
                         summaryMethod="TMP",
                         cutoffCensored="minFeature", censoredInt="0",
                         MBimpute=TRUE,
                         maxQuantileforCensored=0.999)
```
Error in dataProcess(PeakAreas, normalization = "equalizeMedians", summaryMethod = "TMP", : ** MSstats suspects that there are fractionations and potentially technical replicates too. Please add Fraction column in the input.


Add fraction column and have all cells listed as "1" from this google forum post: https://groups.google.com/forum/#!searchin/msstats/fractionations%7Csort:date/msstats/dVh6IEE0xTE/jiokWrNSCgAJ
```{r}
PeakAreas$Fraction <- "1"
PeakAreas
```

Re-try the dataProcess function
```{r}
QuantData <- dataProcess(PeakAreas, normalization='equalizeMedians',
                         summaryMethod="TMP",
                         cutoffCensored="minFeature", censoredInt="0",
                         MBimpute=TRUE,
                         maxQuantileforCensored=0.999)
```
Error in dataProcess(PeakAreas, normalization = "equalizeMedians", summaryMethod = "TMP", : Please remove duplicate rows in the list above.

Remove any duplicate rows:
```{r}
library(dplyr)
mydata <- PeakAreas

# Remove duplicate rows of the dataframe
distinct(mydata)
```
There aren't any duplicate rows... 










